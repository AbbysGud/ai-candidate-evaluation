# Generated by Django 4.2.25 on 2025-10-04 13:14

from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="Candidate",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("name", models.CharField(max_length=200)),
                ("email", models.EmailField(max_length=254, unique=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name="Document",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "type",
                    models.CharField(
                        choices=[
                            ("cv", "CV"),
                            ("report", "Project Report"),
                            ("job_desc", "Job Description"),
                            ("case_brief", "Case Study Brief"),
                            ("scoring_rubric", "Scoring Rubric"),
                        ],
                        default="cv",
                        max_length=20,
                    ),
                ),
                ("filename", models.CharField(default="", max_length=255)),
                ("mime_type", models.CharField(default="", max_length=100)),
                ("sha256_checksum", models.CharField(db_index=True, default="", max_length=64)),
                ("storage_path", models.CharField(default="", max_length=512)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name="Job",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("job_title", models.CharField(max_length=200)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("queued", "queued"),
                            ("processing", "processing"),
                            ("completed", "completed"),
                            ("failed", "failed"),
                        ],
                        default="queued",
                        max_length=12,
                    ),
                ),
                ("attempts", models.PositiveSmallIntegerField(default=0)),
                ("error_code", models.CharField(blank=True, max_length=64, null=True)),
                ("error_message", models.TextField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("started_at", models.DateTimeField(blank=True, null=True)),
                ("completed_at", models.DateTimeField(blank=True, null=True)),
                (
                    "cv_document",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="jobs_as_cv",
                        to="core.document",
                    ),
                ),
                (
                    "report_document",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="jobs_as_report",
                        to="core.document",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="JobStageLog",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "stage",
                    models.CharField(
                        choices=[
                            ("parse_cv", "parse_cv"),
                            ("eval_cv", "eval_cv"),
                            ("parse_report", "parse_report"),
                            ("eval_project", "eval_project"),
                            ("synthesize", "synthesize"),
                        ],
                        max_length=20,
                    ),
                ),
                ("status", models.CharField(max_length=20)),
                ("details", models.JSONField(blank=True, null=True)),
                ("started_at", models.DateTimeField(auto_now_add=True)),
                ("ended_at", models.DateTimeField(blank=True, null=True)),
                (
                    "job",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="stage_logs",
                        to="core.job",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="IdempotencyKey",
            fields=[
                ("key", models.CharField(max_length=64, primary_key=True, serialize=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "job",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="idempotency_keys",
                        to="core.job",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Evaluation",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("cv_match_rate", models.FloatField(blank=True, null=True)),
                ("cv_feedback", models.TextField(blank=True, null=True)),
                ("project_score", models.FloatField(blank=True, null=True)),
                ("project_feedback", models.TextField(blank=True, null=True)),
                ("overall_summary", models.TextField(blank=True, null=True)),
                ("raw_llm", models.JSONField(blank=True, null=True)),
                (
                    "job",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="evaluation",
                        to="core.job",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="DocumentText",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("page_number", models.PositiveIntegerField()),
                ("content", models.TextField()),
                (
                    "document",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="texts",
                        to="core.document",
                    ),
                ),
            ],
        ),
    ]
